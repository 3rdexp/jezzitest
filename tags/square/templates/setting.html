{% extends "base.html" %}

{% block base_head %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&language=zh-CN"></script>
<script type="text/javascript" src="/s/mustache.js"></script>
<script type="text/javascript" src="/s/tmpl.js"></script>
{% end %}

{% block left %}
{% if user %}
<a class="f_actor_a" href="/u/{{user.id}}">
<img class="head" src="{{user.head}}" />
</a>

<div class="blockcontent">
<a class="name" href="/u/{{user.id}}">{{user.nick}}</a><br />
Edit My Profile<br />
</div>
{% end %}
<br /><br />

<ul>
<li><a href="/">新鲜事</a></li>
<li><a href="">站内信</a></li>
<li><a href="">活动</a></li>
<li><a href="">好友</a></li>
</ul>
{% end %}


{% block right %}
<script type="text/javascript">
var geocoder;
var map;
var gr;
function initialize() {
  geocoder = new google.maps.Geocoder();
  var latlng = new google.maps.LatLng(40.083411296333,116.34412714235);
  var myOptions = {
    zoom: 15,
    center: latlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
}

function index(array) {
	return $.inArray( this.data, array );
}

function ResultHtml(r) {
  var ht = ["<li><span>",
    r.address_components[0].long_name,
    "</span><span></span><span></span></li>"
  ];
  
  return ''.join(ht);
}

function showAddress(q, city) {
  gr = null;
  $('#candidate').empty();
  
  if (!geocoder) initialize();
  var address = q + ',' + city;
  
  geocoder.geocode( { 'address': address}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      gr = results;
      var ul = $('<ul></ul>');
      for (var i in results) {
        var r = results[i];
        ul.append(ResultHtml(r));
        
        var marker = new google.maps.Marker({
          map: map, 
          position: r.geometry.location,
          title: r.address_components[0].long_name
          // TODO: clickable: True, and <li> add 事件通知
          // TODO: 鼠标悬停 li 时，改变 marker
          });
      }
      $('#candidate').append(ul);
      
      map.setCenter(results[0].geometry.location);
    } else {
      alert("Geocode was not successful for the following reason: " + status);
    }
  });
}
</script>

<form action="#" onsubmit="showAddress(this.q.value, this.city.value); return false">
对哪里感兴趣：<br />
<input name="q" type="text" value="龙锦苑二区" />
<input name="city" type="text" value="北京" />
<input type="submit" value="search"><br />

<div style="width:800px;height:300px">
<div style="float:left;width:380px;height:300px" id="candidate">候选项</div>
<div style="float:right;width:380px;height:300px" id="map_canvas"></div>
</div>
<br />

<a>添加地址</a>
</form>

{% end %}
